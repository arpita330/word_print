<!DOCTYPE html>
<html>
<head>
    <title>Gift Code Printer - Diagnostic</title>
</head>
<body style="font-family:Arial; padding:20px; text-align:center;">
    <h1>üîç Gift Code Printer Diagnostic</h1>
    
    <div id="step1" style="background:#ffd700; padding:10px; margin:10px; border-radius:5px;">
        Step 1: Testing URL parameters...
    </div>
    
    <div id="step2" style="background:#f0f0f0; padding:10px; margin:10px; border-radius:5px;">
        Step 2: Waiting...
    </div>
    
    <div id="step3" style="background:#f0f0f0; padding:10px; margin:10px; border-radius:5px;">
        Step 3: Waiting...
    </div>
    
    <div id="result" style="margin-top:30px;"></div>

    <script>
        // STEP 1: Get code from URL
        var urlParams = new URLSearchParams(window.location.search);
        var giftCode = urlParams.get('code') || 'NO CODE PROVIDED';
        
        document.getElementById('step1').innerHTML = '‚úÖ Step 1: Code found: <strong>"' + giftCode + '"</strong>';
        document.getElementById('step1').style.background = '#90ee90';
        
        // STEP 2: Test image loading
        document.getElementById('step2').innerHTML = '‚è≥ Step 2: Attempting to load image from GitHub...';
        
        var img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = 'https://raw.githubusercontent.com/arpita330/word_print/main/IMG_20260215_144053_492.jpg';
        
        img.onload = function() {
            document.getElementById('step2').innerHTML = '‚úÖ Step 2: Image loaded successfully! Size: ' + img.width + 'x' + img.height;
            document.getElementById('step2').style.background = '#90ee90';
            
            // STEP 3: Create canvas and draw
            document.getElementById('step3').innerHTML = '‚è≥ Step 3: Creating canvas and drawing...';
            
            try {
                var canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                var ctx = canvas.getContext('2d');
                
                // Draw image
                ctx.drawImage(img, 0, 0);
                
                // Draw text
                ctx.font = 'bold 60px Arial';
                ctx.fillStyle = '#FFD700';
                ctx.shadowColor = '#000000';
                ctx.shadowBlur = 15;
                ctx.shadowOffsetX = 4;
                ctx.shadowOffsetY = 4;
                ctx.textAlign = 'center';
                ctx.fillText(giftCode, canvas.width/2, canvas.height * 0.7);
                
                document.getElementById('step3').innerHTML = '‚úÖ Step 3: Canvas created successfully!';
                document.getElementById('step3').style.background = '#90ee90';
                
                // Display the image
                var imgElement = document.createElement('img');
                imgElement.src = canvas.toDataURL('image/jpeg');
                imgElement.style.maxWidth = '100%';
                imgElement.style.border = '5px solid green';
                
                document.getElementById('result').innerHTML = '<h2>‚úÖ Generated Image:</h2>';
                document.getElementById('result').appendChild(imgElement);
                
                // Also show original for comparison
                var originalImg = document.createElement('img');
                originalImg.src = 'https://raw.githubusercontent.com/arpita330/word_print/main/IMG_20260215_144053_492.jpg';
                originalImg.style.maxWidth = '100%';
                originalImg.style.border = '5px solid blue';
                originalImg.style.marginTop = '20px';
                
                document.getElementById('result').innerHTML += '<h2>üì∏ Original Image (for comparison):</h2>';
                document.getElementById('result').appendChild(originalImg);
                
            } catch(e) {
                document.getElementById('step3').innerHTML = '‚ùå Step 3 Error: ' + e.message;
                document.getElementById('step3').style.background = '#ff6b6b';
            }
        };
        
        img.onerror = function() {
            document.getElementById('step2').innerHTML = '‚ùå Step 2 FAILED: Could not load image from GitHub!';
            document.getElementById('step2').style.background = '#ff6b6b';
            document.getElementById('step2').innerHTML += '<br><br>üîó Image URL: https://raw.githubusercontent.com/arpita330/word_print/main/IMG_20260215_144053_492.jpg';
            document.getElementById('step2').innerHTML += '<br><br>‚ö†Ô∏è Please check if this URL works in your browser:';
            document.getElementById('step2').innerHTML += '<br><a href="https://raw.githubusercontent.com/arpita330/word_print/main/IMG_20260215_144053_492.jpg" target="_blank">Click here to test image URL</a>';
        };
    </script>
</body>
</html>
